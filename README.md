# TF-IDF Анализатор текста

API для анализа текстовых файлов с использованием алгоритма TF-IDF (Term Frequency - Inverse Document Frequency).


## Версия
v0.3.0

# Фидбек от товарища по обучению (Саид Сидиков):

Функциональност проекта соответствует требованиям тз
Документация ясно описывает инструкцию по запуску, конфигурации и структуру проекта. с трудностями при запуске не столкнулся

Эндпоинты исправны и отвечают требованиям проекта, так что никаких значительных изменений я бы не делал

## Описание проекта

TF-IDF Анализатор - это приложение, которое позволяет выполнять анализ текстовых файлов на русском языке, рассчитывая значения TF (частота термина) и IDF (обратная частота документа) для слов в тексте. Это полезно для определения значимости слов в документе относительно коллекции документов.

Основные возможности:
- Для всех дейтвий в приложении необходима авторизация
- Создание учетной записи
- Загрузка текстовых файлов
- Автоматическая токенизация и фильтрация русского текста
- Расчет показателей TF для каждого слова в документе
- Расчет показателей IDF относительно всех документов коллекции
- Отображение 50 наиболее значимых слов, отсортированных по убыванию значения IDF

Основные возможности для активного пользователя:
- Управление учетной записью (изменение, удаление)
- Возможность загружать текстовые фалы 
- Возможность создавать свои коллекции документов и управлять ими (добавить, удалить документ)


## Технический стек

- **Backend**: FastAPI, Python 3
- **База данных**: SQLite с SQLModel (ORM)
- **Обработка текста**: scikit-learn
- **Frontend**: HTML, Bootstrap 5 (В текущей версии неработоспособно)
- **Шаблонизатор**: Jinja2
- **Веб-сервер**: Uvicorn
- **Контейнеризация**: Docker

## Установка и запуск

### Предварительные требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)
- Docker и Docker Compose (для запуска в контейнере)

### Запуск через Docker

1. Клонируйте репозиторий:
```bash
git clone https://github.com/amoglock/intership_lesta.git
cd itership_lesta
```

2. Запустите приложение с помощью Docker Compose:
```bash
docker-compose up -d
```

3. Документация Swagger будет доступна по адресу:
```
http://127.0.0.1:8000/docs
```

### Запуск без Docker

1. Клонируйте репозиторий:
```bash
git clone https://github.com/amoglock/intership_lesta.git
cd itership_lesta
```

2. Создайте и активируйте виртуальное окружение (опционально, но рекомендуется):
```bash
python -m venv venv
source venv/bin/activate  # Для Linux/macOS
# или
venv\Scripts\activate     # Для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Запустите сервер:
```bash
uvicorn src.main:app --reload
```

5. Откройте веб-браузер и перейдите по адресу:
```
http://127.0.0.1:8000/docs
```

## Конфигурация

Приложение можно настроить через переменные окружения или файл `.env`:

| Параметр | Описание | Значение по умолчанию |
|----------|----------|----------------------|
| `APP_HOST` | Хост для запуска приложения | `0.0.0.0` |
| `APP_PORT` | Порт для запуска приложения | `8000` |
| `DEBUG` | Режим отладки | `False` |
| `LOG_LEVEL` | Уровень логирования | `INFO` |
| `DATABASE_URL` | URL подключения к базе данных | *обязательный параметр* |
| `CORS_ORIGINS` | Разрешённые источники для CORS | `["*"]` |
| `UPLOAD_DIR` | Директория для загрузки файлов | `./data/files` |
| `MAX_FILE_SIZE` | Максимальный размер загружаемого файла (в байтах) | `1048576` (1MB) |
| `ALLOWED_EXTENSIONS` | Разрешенные расширения файлов | `[".txt"]` |
| `ALLOWED_FILE_TYPES` | Разрешённые типы файлов | `["text/plain"]` |
| `TOP_WORDS_COUNT` | Количество отображаемых слов | `50` |
| `SECRET_KEY` | Секретный ключ для JWT | *обязательный параметр* |
| `ALGORITHM` | Алгоритм шифрования | *обязательный параметр* |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Время жизни токена (в минутах) | *обязательный параметр* |

## Структура проекта

```
.
├── src/              # Исходный код приложения
│   ├── core/         # Основные настройки и утилиты
│   │   ├── config.py # Конфигурация приложения
│   │   └── version.py # Версионирование
│   ├── users/        # Модуль пользователей
│   │   ├── auth.py   # Аутентификация
│   │   ├── dependencies.py # Зависимости
│   │   ├── repository.py # Работа с БД
│   │   ├── router.py # Маршруты
│   │   └── schemas.py # Схемы данных
│   ├── documents/    # Модуль документов
│   │   ├── dependencies.py # Зависимости
│   │   ├── exceptions.py # Исключения
│   │   ├── repository.py # Работа с БД
│   │   ├── router.py # Маршруты
│   │   ├── schemas.py # Схемы данных
│   │   └── service.py # Бизнес-логика
│   ├── collections/  # Модуль коллекций
│   │   ├── repository.py # Работа с БД
│   │   ├── router.py # Маршруты
│   │   ├── schemas.py # Схемы данных
│   │   └── service.py # Бизнес-логика
│   ├── tf_idf/       # Модуль TF-IDF анализа
│   │   ├── processor.py # Обработка текста
│   │   └── schemas.py # Схемы данных
│   ├── frontend/     # Фронтенд часть
│   │   ├── router.py # Маршруты
│   │   ├── static/   # Статические файлы
│   │   └── templates/ # HTML шаблоны
│   ├── models.py     # Модели данных
│   ├── database.py   # Настройка БД
│   └── main.py       # Точка входа
├── .dockerignore     # Исключения для Docker
├── .gitignore        # Исключения для Git
├── docker-compose.yml # Конфигурация Docker Compose
├── Dockerfile        # Инструкции для сборки Docker
├── README.md         # Документация проекта
└── requirements.txt  # Зависимости Python
```

Подробное описание структуры базы данных и связей между таблицами можно найти в [документации базы данных](docs/database.md).

## Changelog


### v0.1.0 (Тестовое задание)
- Базовая реализация TF-IDF анализатора
- Простой веб-интерфейс для загрузки файлов
- Базовая обработка русского текста
- Хранение результатов в SQLite

### v0.2.0 (Первая неделя)
- Добавлена поддержка Docker и Docker Compose
- Улучшена обработка ошибок и валидация входных данных
- Добавлена конфигурация через переменные окружения
- Все параметры конфигурации вынесены в .env (порты, БД, CORS, типы файлов, лимиты, логирование)
- Добавлены эндпоинты:
  - `/status` — для проверки статуса приложения (возвращает `{"status": "OK"}`)
  - `/metrics` — возвращает метрики приложения (см. ниже)
  - `/version` — возвращает версию приложения
- Метрики дополнительно к имеющимся:
  - `max_content_length` — максимальная длина текста в загруженном файле (помогает определить оптимальные лимиты для обработки)
  - `avg_content_length` — средняя длина текстов в приложении (помогает оптимизировать производительность)
- Аргументация метрик:
  - `max_content_length` позволяет:
    - Определить оптимальные лимиты для загружаемых файлов
    - Выявить потенциальные проблемы с производительностью
    - Настроить обработку
  - `avg_content_length` помогает:
    - Оптимизировать размер базы данных
    - Настроить параметры базы данных
    - Определить оптимальные настройки для TF-IDF анализа
    - Планировать масштабирование системы

### v0.3.0 (Вторая неделя)
  - Полностью пересмотрены сущности для моделей базы данных
  - Добавлены новые модели для документов, коллекций, пользователей
  - Удалены ранее использовавшиеся таблицы
  - Пересмотрена логика получения содержимого документа
  - Уменьшен максимальный размер файла для обработки
  - Переделаны эндпоинты возврата статистики документов с JSONResponse на объекты
  - Добавлена авторизация и аутентификация. Действия в приложении доступны только авторизованным пользователям
  - Добалены эндпоинты для документов, коллекций и пользователей
  - Добавлена реализация добавления документа в несколько коллекций
  - Изменена обработка текста для получения статистики. Вместо NLTK используется scikit-learn
  - Изменены модели валидации, добавлены новые методы в файлы бизнес-логики
  - Добавлены дополнительные переменные окружения

## Как это работает
- В текущей реализации, по адресу http://127.0.0.1:8000/ отображается веб интерфейс загрузки файлов в качестве заглушки. Используйте страницу документации Swagger или сгененрированный клиент (см. ниже)
- Все действия с документами и коллекциями доступны только авторизованным пользователям
- Пользователь может работать только со своими документами и коллекциями
- После загрузки файла, создается документ, доступный пользователю
- Для получения статистики по документу, он должен находиться к коллекции
- Документ может быть добавлен в несколько коллекций.
- При удалении профиля пользователя, удаляются все коллекции, документы и загруженные файлы пользователя

### TF (Term Frequency)

Частота термина показывает, насколько часто слово встречается в документе.

### IDF (Inverse Document Frequency)

Обратная частота документа показывает, насколько редко слово встречается во всей коллекции документов.

### Обработка текста

1. Для обработки текста используется библиотека scikit-learn
2. Для каждого слова рассчитываются значения TF и IDF (в рамках коллекции).
3. Результаты сортируются по убыванию значения IDF и выводятся 50 верхних слов.

## Генерация клиента API

Приложение предоставляет OpenAPI спецификацию, доступную по адресу `/openapi.json`. На её основе можно сгенерировать клиентский код для различных языков программирования.

### Генерация клиента


#### Python
```bash
# Создайте новый проект, активируйте виртуальное окружение и установите генератор
pip install openapi-generator-cli

# Генерация клиента в проекте на примере локально запущенного приложения
openapi-python-client generate --url http://127.0.0.1:8000/openapi.json
```

### Использование сгенерированного клиента

#### Python
```python
from tf_idf_analyzer_client import Client
import tf_idf_analyzer_client.api.metrics.get_status_status_get as metrics_status


def get_status():
    client = Client(base_url="http://127.0.0.1:8000")
    print(metrics_status.sync(client=client))

get_status()

>>> StatusResponse(status='ok', additional_properties={})
```
Пример генерации клиента можно увидеть в лекции по Swagger.

Так же можно посмотреть еще один генератор [OpenAPI Generator](https://openapi-generator.tech/).
